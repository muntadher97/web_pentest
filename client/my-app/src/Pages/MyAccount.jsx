import React,{useContext,useEffect,useState} from 'react'
import { AuthContext } from '../context/authContext'
import axios from 'axios'
function MyAccount() {
    const [input,setInput]=useState({email:""})
    const [err,setErr]=useState(null);
    const [email,setEmail]=useState("");
    const {curentUser}=useContext(AuthContext);
    const handleChange= e =>{
        setInput(prev=>({...prev,[e.target.name]:e.target.value}))
      }

      const handleSubmit= async e=>{
        e.preventDefault();
        try {
          const res=await axios.put(`/users/change-email`,input)
          //to fetch email when submit
          const res2=await axios.get(`/users/get-email`)
          setEmail(res2.data[0].email)
          //setEmail(curentUser.email)
          console.log(res)
        } catch (error) {
          setErr(error.response.data);
        }
        
    }
    //to fetch email on load page
    useEffect(()=>{
        const fetchData=async ()=>{
          try{
            const res=await  axios.get(`/users/get-email`,input)
            setEmail(res.data[0].email)
            //console.log(res.data[0].email)
            
          }catch(err){
            console.log(err)
          }
        };
        fetchData();
       },[])
   
    
  return (
    <div className='myAccount'>
        <div className="account_info">
            <label className="username">Account: {curentUser.user} </label>
            <label className="email">Email: {email} </label>
            <form onSubmit={handleSubmit} action="">
            <input required={true} type="email" placeholder="Write new email" name='email' onChange={handleChange}/>
            
            <button type="submit" >change</button>
            </form>
        </div>
    </div>
  )
}

export default MyAccount