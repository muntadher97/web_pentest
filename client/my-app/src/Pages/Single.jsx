import Edit from '../img/edit.png'
import Delete from '../img/delete.png'
import { Link, useNavigate } from 'react-router-dom'
import Menu from '../componants/Menu'
import axios from 'axios'
import React, { useContext, useEffect, useState } from 'react'
import { useLocation } from 'react-router-dom'
import moment from "moment"
import { AuthContext } from '../context/authContext'

function Single() {
  
  const [post,setPost]=useState({})
  const location = useLocation()
  const postId=location.pathname.split("/")[2]
  const {curentUser}=useContext(AuthContext);
  const navigate = useNavigate({})
   useEffect(()=>{
    const fetchData=async ()=>{
      try{
        const res=await axios.get(`/posts/${postId}`)
        setPost(res.data)
        
        
      }catch(err){
        console.log(err)
      }
    };
    fetchData();
   },[postId])
    const handleDelete=async ()=>{
      try {
        await axios.delete(`/posts/${postId}`);
        navigate("/")
      } catch (error) {
        console.log(error)
      }
    }
  return (
    <div className="single">
      <div className="content">
        <img src={`../upload/${post?.img}`} alt="" />
        <div className="user">
          {post.userImg && <img src={post.userImg} alt="" />}
          <div className="info">
            <span>{post.user}</span>
            <p>posted {moment(post.date).fromNow()}</p>
          </div>
         {curentUser.user === post.user && <div className="modfiy_btn">
            <Link to={`/write?edit=2`} state={post}>
            <img src={Edit} alt="" />
            </Link>
            <img onClick={handleDelete} src={Delete} alt="" />
          </div>}
        </div>
        <h1>{post.title}</h1>
        <p>{post.desc}</p>
      </div>
      <Menu cat={post.cat}/>
    </div>
  )
}

export default Single