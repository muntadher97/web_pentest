import { db } from "../db.js"
import jwt from "jsonwebtoken"


export const changeEmail=(req,res)=>{
    const token = req.cookies.access_token
    if(!token) return res.status(401).json("Not authenticated!")

    jwt.verify(token,"jwtkey",(err,userInfo)=>{
        if(err) return res.status(403).json("token is not valid")
        //const userId=req.params.id;
        const q="UPDATE users SET `email`=? WHERE `id`=?"
        const values = [
            req.body.email
        ]

        db.query(q,[...values,userInfo.id],(err,data)=>{
            if(err) return res.status(500).json(err)
            return res.json("email has been changed.")
        })
    });
}

export const gateEmail=(req,res)=>{
    const token = req.cookies.access_token
    if(!token) return res.status(401).json("Not authenticated!")

    jwt.verify(token,"jwtkey",(err,userInfo)=>{
        if(err) return res.status(403).json("token is not valid")
        //const userId=req.params.id;
        const q="SELECT email FROM users where id=?;"

        db.query(q,userInfo.id,(err,data)=>{
            if(err) return res.status(500).json(err)
            return res.json(data)
        })
    });
}